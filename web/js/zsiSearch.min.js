/*! zsiSearch - v1.0.0 */zsi.search=new function(){this.InputSearch,this.Panel,this.Grid,this.Url,this.Parameter,this.ColumnIndexes,this.data=null,this.timer,this.OnLoadComplete,this.OnSelectedItem,this.OnRequestFailed},zsi.search.setDataIndex=function(e){if(zsi.search.OnSelectedItem){if(!this.data)return;this.data.rows.length>0&&zsi.search.OnSelectedItem(this.data.rows[e].data,e)}},zsi.search.init=function(e){function a(){var e=zsi.search.InputSearch.val();zsi.search.data&&e.length>=2&&zsi.search.data.rows.length>0&&zsi.search.Panel.show(!0)}e.panel||(e.panel={id:"panel","class":"SearchPanel"}),e.grid||(e.grid={id:"grid","class":"SearchGrid"}),this.InputSearch=$(e.input),this.Url=e.url,this.Parameter=e.parameter,this.OnSelectedItem=e.onSelectedItem,this.OnLoadComplete=e.onLoadComplete,this.OnRequestFailed=e.onRequestFailed;var s="<br />";s+='<div class="'+e.panel.class+'" >',s+='<table id="'+e.grid.id+'"  class="table '+e.grid.class+'">',s+="<thead>",s+="<tr>";for(var t=0;e.column_names.length>t;t++)s+="<th>"+e.column_names[t]+"</th>";s+="</tr>",s+="</thead>",s+="</table>",s+="</div>",$(s).appendTo("body"),this.Panel=$("."+e.panel.class),this.Grid=$("."+e.grid.class),this.ColumnIndexes=e.column_indexes;var i=this.InputSearch.offset();this.Panel.css("left",i.left+"px"),this.Panel.css("top",this.InputSearch.outerHeight()+i.top+"px"),this.Panel.css("width",this.InputSearch.outerWidth()+"px"),this.Panel.show=function(e){this.css("display",1==e?"block":"none")},this.InputSearch.keyup(function(e){zsi.search.Panel;var s=zsi.search.Grid;switch(e.keyCode){case 9:break;case 17:break;case 18:break;case 39:break;case 37:break;case 40:a();var t=s.find("tbody > tr.active"),i=s.find("tbody > tr");t.each(function(){var e=$(this).index();e!=i.length-1&&($(this).removeClass("active"),$(this).next().addClass("active"),e>=8&&zsi.search.Panel.scrollTop($(this).next().position().top),zsi.search.setDataIndex(e+1))}),0==t.length&&i.length>0&&($(s.find("tbody > tr")[0]).addClass("active"),zsi.search.setDataIndex(0));break;case 38:a();var t=s.find("tbody > tr.active");t.each(function(){var e=$(this).index();0!=e&&($(this).removeClass("active"),$(this).prev().addClass("active"),8>=e&&zsi.search.Panel.scrollTop(0),zsi.search.setDataIndex(e-1))});break;case 13:zsi.search.Panel.show(!1);break;default:clearTimeout(zsi.search.timer);var n=this.value;n.length>=2?zsi.search.timer=setTimeout(function(){zsi.search.Panel.scrollTop(0);var e="?"+zsi.search.Parameter+"="+n;$.getJSON(zsi.search.Url+e,onSearchComplete).fail(function(){zsi.search.OnRequestFailed&&zsi.search.OnRequestFailed()})},500):(zsi.search.data=null,zsi.search.Panel.show(!1),s.clearGrid())}}).focus(function(){a()}).click(function(){a()}),$(document).click(function(e){$(e.target).is("html")&&zsi.search.Panel.show(!1)})},onSearchComplete=function(e){var a=zsi.search.Grid;a.clearGrid(),zsi.search.data=e,zsi.search.OnLoadComplete&&zsi.search.OnLoadComplete(e),e.rows.length>0&&zsi.search.Panel.show(!0),$.each(e.rows,function(){var e=zsi.search.ColumnIndexes,s="";s+="<tr>";for(var t=0;e.length>t;t++)this.data[e[t]]=unescape(this.data[e[t]]),s+="<td>"+this.data[e[t]]+"</td>";s+="</tr>",a.append(s)}),a.find("tbody > tr").each(function(){$(this).click(function(){var e=a.find("tbody > tr.active");e.length>0&&$(e[0]).removeClass("active"),$(this).addClass("active"),zsi.search.setDataIndex($(this).index()),zsi.search.Panel.show(!1)})})};